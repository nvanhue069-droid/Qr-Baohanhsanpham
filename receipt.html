<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Phi·∫øu b·∫£o h√†nh</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
<div class="container py-5">
  <h2 class="mb-4">üîê Th√¥ng tin phi·∫øu b·∫£o h√†nh</h2>

  <div id="loading">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ blockchain...</div>

  <div id="info" class="card p-4 d-none">
    <p><b>S·∫£n ph·∫©m:</b> <span id="product"></span></p>
    <p><b>Kh√°ch h√†ng:</b> <span id="customer"></span></p>
    <p><b>Ng√†y b·∫Øt ƒë·∫ßu:</b> <span id="start"></span></p>
    <p><b>Ng√†y h·∫øt h·∫°n:</b> <span id="end"></span></p>
    <p><b>Tr·∫°ng th√°i:</b> <span id="status"></span></p>
  </div>
</div>

<script>
const abi = [
  "function getWarranty(uint256 id) view returns (string, string, uint256, uint256, bool)"
];

async function loadWarranty() {
  const params = new URLSearchParams(window.location.search);
  const contractAddress = params.get("contract");
  const id = params.get("id");

  const provider = new ethers.providers.JsonRpcProvider(
    "https://rpc.sepolia.org"
  );

  const contract = new ethers.Contract(contractAddress, abi, provider);

  const data = await contract.getWarranty(id);

  document.getElementById("product").innerText = data[0];
  document.getElementById("customer").innerText = data[1];
  document.getElementById("start").innerText =
    new Date(data[2] * 1000).toLocaleDateString();
  document.getElementById("end").innerText =
    new Date(data[3] * 1000).toLocaleDateString();
  document.getElementById("status").innerText =
    data[4] ? "C√≤n hi·ªáu l·ª±c ‚úÖ" : "H·∫øt h·∫°n ‚ùå";

  document.getElementById("loading").classList.add("d-none");
  document.getElementById("info").classList.remove("d-none");
}

loadWarranty();
</script>
</body>
</html>
